<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soldier Module Test</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
        }
        #controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
        }
        button {
            background: #00ff88;
            border: none;
            color: #000;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #00cc6a;
        }
    </style>
</head>
<body>
    <div id="container">
        <canvas id="canvas"></canvas>
        
        <div id="info">
            <h3>Soldier Module Test</h3>
            <p>Click buttons to test different soldier variants</p>
        </div>
        
        <div id="controls">
            <button onclick="createNormalSoldier()">Normal Soldier</button>
            <button onclick="createWoundedSoldier()">Wounded Soldier</button>
            <button onclick="toggleAnimation()">Toggle Animation</button>
            <button onclick="resetScene()">Reset</button>
        </div>
    </div>

    <script type="module">
        import * as THREE from './js/three.module.min.js';
        import { createSoldier, updateSoldier, createWoundedSoldier, createRifle } from './js/soldier.js';

        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas') });
        
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.setClearColor(0x000011);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(10, 10, 5);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 2048;
        directionalLight.shadow.mapSize.height = 2048;
        scene.add(directionalLight);

        // Ground
        const groundGeometry = new THREE.PlaneGeometry(20, 20);
        const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x2c3e50 });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // Camera position
        camera.position.set(0, 5, 10);
        camera.lookAt(0, 0, 0);

        // Animation state
        let currentSoldier = null;
        let isAnimating = false;
        let clock = new THREE.Clock();

        // Global functions for buttons
        window.createNormalSoldier = function() {
            if (currentSoldier) {
                scene.remove(currentSoldier.group);
            }
            
            currentSoldier = createSoldier({
                scale: 1,
                helmetColor: 0x2ecc71,
                uniformColor: 0x4169E1,
                skinColor: 0xffdbac,
                bootColor: 0x2c3e50
            });
            
            // Add rifle
            const rifle = createRifle({ scale: 1 });
            rifle.position.set(0.3, 0.5, 0);
            rifle.rotation.z = -0.2;
            currentSoldier.group.add(rifle);
            
            scene.add(currentSoldier.group);
            isAnimating = true;
        };

        window.createWoundedSoldier = function() {
            if (currentSoldier) {
                scene.remove(currentSoldier.group);
            }
            
            currentSoldier = createWoundedSoldier({
                scale: 1,
                helmetColor: 0x8B4513,
                uniformColor: 0x654321,
                skinColor: 0xffdbac,
                bootColor: 0x2c3e50
            });
            
            scene.add(currentSoldier.group);
            isAnimating = false;
        };

        window.toggleAnimation = function() {
            if (currentSoldier) {
                isAnimating = !isAnimating;
            }
        };

        window.resetScene = function() {
            if (currentSoldier) {
                scene.remove(currentSoldier.group);
                currentSoldier = null;
            }
            isAnimating = false;
        };

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            const deltaTime = clock.getDelta();
            
            if (currentSoldier && isAnimating) {
                updateSoldier(currentSoldier, deltaTime, {
                    speed: 2.0,
                    moving: true
                });
            }
            
            renderer.render(scene, camera);
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Start with a normal soldier
        createNormalSoldier();
        animate();
    </script>
</body>
</html>
