<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Intro</title>
    <style>
        body { margin: 0; padding: 0; background: #000; color: #fff; font-family: monospace; }
        #intro-root { width: 100vw; height: 100vh; position: relative; }
        #debug-info { position: absolute; top: 10px; left: 10px; z-index: 1000; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 5px; }
        canvas { display: block; }
    </style>
</head>
<body>
    <div id="intro-root">
        <canvas id="intro"></canvas>
        <div id="debug-info">
            <div>Loading...</div>
        </div>
    </div>
    
    <script type="module">
        const debugInfo = document.getElementById('debug-info');
        
        function log(message) {
            console.log(message);
            debugInfo.innerHTML += '<div>' + message + '</div>';
        }
        
        try {
            log('Starting debug...');
            
            // Test Three.js import
            log('Importing Three.js...');
            const THREE = await import('./js/three.module.min.js');
            log('✓ Three.js loaded: ' + Object.keys(THREE).length + ' exports');
            
            // Test other imports
            log('Importing utils...');
            const { SplineUtils, MathUtils } = await import('./js/utils.js');
            log('✓ Utils loaded');
            
            log('Importing particles...');
            const { ParticleSystem } = await import('./js/particles.js');
            log('✓ Particles loaded');
            
            // Create basic scene
            log('Creating scene...');
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000011);
            
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 10);
            
            const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('intro') });
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            // Add much brighter lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 1.2);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 2.0);
            directionalLight.position.set(10, 20, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Add fill light
            const fillLight = new THREE.DirectionalLight(0xffffff, 0.8);
            fillLight.position.set(-10, 10, -5);
            scene.add(fillLight);
            
            // Create character
            log('Creating character...');
            const characterGroup = new THREE.Group();
            
            const bodyGeometry = new THREE.CapsuleGeometry(0.3, 1.2, 4, 8);
            const bodyMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x4169E1,
                emissive: 0x111133
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0.6;
            body.castShadow = true;
            characterGroup.add(body);
            
            const headGeometry = new THREE.SphereGeometry(0.25, 8, 6);
            const headMaterial = new THREE.MeshLambertMaterial({ 
                color: 0xffdbac,
                emissive: 0x221100
            });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 1.4;
            head.castShadow = true;
            characterGroup.add(head);
            
            // Add arms
            const armGeometry = new THREE.CapsuleGeometry(0.1, 0.8, 4, 6);
            const armMaterial = new THREE.MeshLambertMaterial({ 
                color: 0xffdbac,
                emissive: 0x221100
            });
            
            const leftArm = new THREE.Mesh(armGeometry, armMaterial);
            leftArm.position.set(-0.4, 0.8, 0);
            leftArm.rotation.z = 0.3;
            leftArm.castShadow = true;
            characterGroup.add(leftArm);
            
            const rightArm = new THREE.Mesh(armGeometry, armMaterial);
            rightArm.position.set(0.4, 0.8, 0);
            rightArm.rotation.z = -0.3;
            rightArm.castShadow = true;
            characterGroup.add(rightArm);
            
            scene.add(characterGroup);
            log('✓ Character created');
            
            // Create ground
            const groundGeometry = new THREE.PlaneGeometry(50, 50);
            const groundMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x2c3e50,
                emissive: 0x111122
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            log('✓ Ground created');
            
            // Create portal
            const portalGeometry = new THREE.TorusGeometry(2, 0.3, 8, 32);
            const portalMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x00ffff,
                transparent: true,
                opacity: 0.8
            });
            const portal = new THREE.Mesh(portalGeometry, portalMaterial);
            portal.position.set(0, 2, -20);
            scene.add(portal);
            log('✓ Portal created');
            
            // Test spline
            log('Creating spline...');
            const spline = SplineUtils.generateTrenchPath(50, 20);
            log('✓ Spline created with ' + spline.points.length + ' points');
            
            // Test particle system
            log('Creating particle system...');
            const particleSystem = new ParticleSystem(scene, { smoke: 10, fire: 5, bullets: 5, explosions: 2 });
            await particleSystem.init();
            log('✓ Particle system created');
            
            // Animation
            let frameCount = 0;
            let time = 0;
            function animate() {
                requestAnimationFrame(animate);
                
                frameCount++;
                time += 0.016; // ~60fps
                
                if (frameCount % 60 === 0) {
                    log('Frame: ' + frameCount + ', Character pos: ' + characterGroup.position.toArray().map(v => v.toFixed(2)).join(', '));
                }
                
                // Move character along a path
                characterGroup.position.x = Math.sin(time * 0.5) * 2;
                characterGroup.position.z = -time * 2; // Move forward
                
                // Rotate character
                characterGroup.rotation.y += 0.01;
                
                // Rotate portal
                portal.rotation.y += 0.02;
                
                // Update particles
                particleSystem.update(16.67);
                
                // Update camera to follow character
                camera.position.x = characterGroup.position.x;
                camera.position.z = characterGroup.position.z + 10;
                camera.lookAt(characterGroup.position);
                
                renderer.render(scene, camera);
            }
            
            log('Starting animation...');
            animate();
            log('✓ Debug complete - everything working!');
            
        } catch (error) {
            log('❌ ERROR: ' + error.message);
            log('Stack: ' + error.stack);
        }
    </script>
</body>
</html>
